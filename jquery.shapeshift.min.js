(function(e,c,g){var d="shapeshift",a=c.document,f={adjustContainerHeight:true,animated:true,animatedOnDrag:true,centerGrid:true,columns:null,draggable:true,objWidth:null,gutterX:10,gutterY:10,resizable:true,selector:""};function b(j,h){var i=this;i.element=j;i.options=e.extend({},f,h);i._defaults=f;i._name=d;i.objPositions=[];i.hoverObjPositions=[];i.init()}b.prototype.init=function(){var i=this,h=i.options;i.shiftit(h.animated);if(h.draggable){i.draggable()}if(h.resizable){i.resizable()}};b.prototype.shiftit=function(m){var t=this,u=t.options,s=e(t.element),o=s.children(u.selector).filter(":visible"),k=u.columns,q=[],n=null,p=0;if(!u.draggable){s.droppable("destroy");o.draggable("destroy");o.droppable("destroy")}t.objPositions=t.getObjectPositions(":visible");for(var j=0;j<o.length;j++){var h=e(o[j]),l=t.objPositions[j];if(!h.hasClass("ss-moving")){if(m){h.stop(true,false).animate(l,250)}else{h.css(l)}}}if(u.adjustContainerHeight){var i=t.tallestCol(q),r=3000;s.css("height",r)}};b.prototype.draggable=function(){var q=this,r=q.options,p=e(q.element),k=p.children(r.selector).filter(":visible"),i=null,l=null,o=false;k.draggable({containment:"document",cursor:"move",start:function(s){n(e(this),s)},drag:function(s){j(e(this),s)}});k.droppable({over:function(){h(e(this))}});p.droppable({drop:function(){m()}});function n(s,t){i=s;i.addClass("ss-moving");q.setHoverObjPositions();q.shiftit(r.animatedOnDrag)}function j(s,t){if(!o){k=p.children(r.selector).filter(":visible");o=true;intendedIndex=q.getIntendedIndex(s,t);$intendedObj=e(k.not(".ss-moving").get(intendedIndex));i.insertBefore($intendedObj);q.shiftit(r.animatedOnDrag);c.setTimeout(function(){o=false},200)}}function h(s){l=s}function m(){i.removeClass("ss-moving");q.shiftit(r.animateOnDrag);p.trigger("shapeshifted")}};b.prototype.getIntendedIndex=function(q,p){var u=this,v=u.options,s=e(u.element),o=s.offset().left,n=s.offset().top,k=q.offset().left-o,j=q.offset().top-n+v.gutterY+10,m=p.pageX,l=p.pageY,i=k+((m-k)/2),h=j+((l-j)/2),r=9999,t=0;for(hov_i=0;hov_i<u.hoverObjPositions.length;hov_i++){attributes=u.hoverObjPositions[hov_i];if(i>attributes.left&&h>attributes.top){xDist=i-attributes.left;yDist=h-attributes.top;distance=Math.sqrt((xDist*xDist)+(yDist*yDist));if(distance<r){r=distance;t=hov_i}}}return t};b.prototype.setHoverObjPositions=function(){var h=this;h.hoverObjPositions=h.getObjectPositions(":not(.ss-moving):visible")};b.prototype.getObjectPositions=function(j){var x=this,y=x.options,w=e(x.element),r=w.children(y.selector).filter(j),m=y.columns,u=[],q=null,t=0,p=[];if(!y.objWidth){y.objWidth=r.first().outerWidth(true)}q=y.objWidth+y.gutterX;if(!m){m=Math.floor(w.innerWidth()/q)}if(y.centerGrid){t=Math.floor(((w.innerWidth()/q)%1*q)/2)}for(var o=0;o<m;o++){u.push(0)}for(var l=0;l<r.length;l++){var h=e(r[l]),k=x.shortestCol(u),v=h.outerHeight(true)+y.gutterY,s=(q*k)+t,n=u[k];attributes={left:s,top:n};p[l]=attributes;u[k]+=v}return p};b.prototype.shortestCol=function(h){return e.inArray(Math.min.apply(c,h),h)};b.prototype.tallestCol=function(h){return e.inArray(Math.max.apply(c,h),h)};b.prototype.resizable=function(){var j=this,i=j.options,h=false;e(c).on("resize",function(){if(!h){h=true;j.shiftit(i.animated);setTimeout(function(){h=false;j.shiftit(i.animated)},100)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));